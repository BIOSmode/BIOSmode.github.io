

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/BIOS.png">
  <link rel="icon" type="image/png" href="/img/BIOS.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Leopard SUN">
  <meta name="keywords" content="">
  <title>Transit Navigation Satellite System - 13IoS&#39; Homepage</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>13IoS' Homepage</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://sunguiyu.github.io">
                <i class="iconfont icon-link-fill"></i>
                Academic Web
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-10-23 20:26" pubdate>
        October 23, 2020 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.9k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      29
       分钟
    </span>
  

  
  
    
      <!-- LeanCloud 统计文章PV -->
      <span id="leancloud-post-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-post-views"></span> 次
      </span>
    
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">Transit Navigation Satellite System</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：3 years ago
                
              </p>
            
            <div class="markdown-body" id="post-body">
              <p>最近在做对于多普勒定位的时间误差因素相关问题，阅读了最初的介绍子午仪的文献，原笔记记录在onenote上，整理之后分享出来~<br><a id="more"></a></p>
<h2 id="子午仪导航系统"><a href="#子午仪导航系统" class="headerlink" title="子午仪导航系统"></a>子午仪导航系统</h2><p>高度约为1075公里 , 每环绕地球一周需要107分钟。<br><strong>子午仪卫星定位的过程是：</strong> 接收每一颗卫星所发射的讯息，<strong>精确地</strong>算出它的作为时间函数的位置，将这些计算出来的卫星位置联合起来，测量它们到观测点的距离差（多普勒计数），并考虑船只的运动速度，就能准确地知道观测点的位置。</p>
<h3 id="1-误差来源"><a href="#1-误差来源" class="headerlink" title="1. 误差来源"></a>1. 误差来源</h3><p>用子午仪卫星定位时有二个主要的误差源。第一个误差源是系统的固有误差；第二个误差源则是在卫星通过期闻船只运动速度的测量误差引起的。对于静态定位，误差的主要来源基本都归属于固有误差。<br><strong>在一个固定点上观测定位结果的分放性可以测定系统的固有误差。</strong> 一个双频道子午仪卫星接收机的残留分散性的均方根值是32米。典型的双频道接收机的定位误差是27-37米（均方根值）。单频道卫星接收机，它不能测量和消除电离层折射所造成的误差，所以定位误差达80米至100米（均方根值）。</p>
<h4 id="第一个折射误差源是电离层。"><a href="#第一个折射误差源是电离层。" class="headerlink" title="第一个折射误差源是电离层。"></a>第一个折射误差源是电离层。</h4><p>  由于电离层折射可使单频道定位结果最大达200-500米，而对双频道则只有90米。使用只有400MHz一个频道。由于波长被拉长了，使得卫星好像是沿着具有更大曲率的路径通过卫星接收机的顶部似的。这种效应稍微减少了总的多普勒频移，使卫星定位的解偏离了卫星轨道。这也是多普勒曲线陡度较小的原因。由于卫星主要是沿着南北线运动的，所以最后的定位误差几乎全是经度方向上的误差。这个误差是电离层密度的函数，夜间误差非常小，白夫误差很大，最大值可达200米至500米，这是由于太阳黑子的活动和磁赤道的影响所致。在磁赤道上，电离层的密度最大。为了发射精密的时间讯息，在150M和400M讯号上增加了一个高频伪随机噪声（PRN）。这样，即使单频道卫星接收机也可以进行电离层折射校正（检测群延迟和相延迟之间的差值），而且，经过适当改装的卫星接收机还能够从其它的卫星中区分出所选定的卫星讯号，从而消除了卫星轨道交叉时所造成的干扰。</p>
<h4 id="第二个折射误差源是大气层。"><a href="#第二个折射误差源是大气层。" class="headerlink" title="第二个折射误差源是大气层。"></a>第二个折射误差源是大气层。</h4><p>  当讯号穿过地球大气层时，讯号传播速度被减缓了，大气层压缩了讯号波长。这种影响正比于发射频率，因而不能像电离层那样进行检测。解决方法：1. 模拟方法。测量温度，压力和湿度进行模拟，它是非常成熟和完善的。如果和第二种方法联系起来，这点就更为明显了。在第二种方法中，去掉那些靠近地平线的数据，因为这些数据中包含的大气层折射误差最大。当卫星的仰角超过5°至10°时，大气层折射误差比地平线上时的误差小许多倍。STK采用的Harris Priester 大气模型 ,考虑了大气周日密度变化和太阳紫外线辐射流量的影响。采用了 7～8 阶 Runge-Kutta-Fehlberg 方法积分求解卫星运动方程。    </p>
<div class="table-container">
<table>
<thead>
<tr>
<th>误差源</th>
<th>误差值/m</th>
</tr>
</thead>
<tbody>
<tr>
<td>传播效应（电离层和大气层影响）没有进行校正</td>
<td>1-5</td>
</tr>
<tr>
<td>仪器和测量噪声（本机和卫星振荡器的相位抖动，接收机的吋钟误差）</td>
<td>3-6</td>
</tr>
<tr>
<td>用来计算卫星轨道的地球物理场模型不正确</td>
<td>10-20</td>
</tr>
<tr>
<td>接收机的高度不正确（通常只引起经度偏离）</td>
<td>10</td>
</tr>
<tr>
<td>不能模拟的极点运动和UTⅠUTC效应</td>
<td>0-10</td>
</tr>
<tr>
<td>对表面力（在外推期间作用在卫星上的曳力和輻射压力）的模拟不正确</td>
<td>10-25</td>
</tr>
<tr>
<td>星历舍入误差（在星磨舍入时的最后一位）</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
<h3 id="2-轨道误差"><a href="#2-轨道误差" class="headerlink" title="2. 轨道误差"></a>2. 轨道误差</h3><p>同卫星研制工作齐头并进的一项计划,皆在得到高精度的地球重力场模型。这项工作一直延续到现在还在做。为得到在轨道上运行的一颗卫星实际上的连续覆盖,在世界各地建立了由13个跟踪站组成的台站网。“子午仪”和其它适宜的卫星是用这个跟踪台站网来跟踪的,并把数据传送给应用物理实验室进行分析。计算分析包括处理跟踪数据和计算地球重力场模型(以一个由几百个球谐项级数组成的表达式),这是一项繁重的任务。但是这项计算任务还是有收获的,因为使轨道预报误差减小至小于10米。</p>
<h5 id="单点定位时，轨道的误差对定位的影响"><a href="#单点定位时，轨道的误差对定位的影响" class="headerlink" title="单点定位时，轨道的误差对定位的影响"></a>单点定位时，轨道的误差对定位的影响</h5><p>利用卫星运动方程式的数字积分法获得的。通常不能够精确地测出这些力，所以预测的轨道常常偏离实际的轨道。在单次卫星通过时，这个偏离值常常可以达到27米到37米。<br>如果可以不用预测轨道参数，而用实际跟踪的轨道参数，则将会获得更为精确的成果。美国国土保卫局（DMA）采用了这种技术，减少了诸如AN/PRR-14型大地接收机野外所记录的卫星多普勒数据。在野外用磁带记录下测量数据，送至计算中心进行处理。在计算中心根据实际跟踪到的轨道将多普勒数据和卫星位置的精密星历联合起来，这样，单次观测结果的分散性只有6.3米（均方根值）。当然，用这种方法对三维，卫星多次通过求解时，比用预溯轨道参数求解时收敛要快得多。然而DMA在一个时间很难计算一个以上的精密卫星星历，所以在野外不能立即得出测量成果，这就使这种方法的优点稍有逊色。<br>但是，即使如此，为了获得同样的精度，利用预测轨道参数的设备在测站上必须保持的时间是利用精密星历的设备的4倍到10倍。在利用25次精密星历以后，DMA获得了每个轴的重复性为15米的三维定位成果。</p>
<h3 id="3-定位原理"><a href="#3-定位原理" class="headerlink" title="3. 定位原理"></a>3. 定位原理</h3><p>卫星不断播发<strong>偶数分钟开始时刻的轨道参数</strong>。卫星以7.3公里/秒的速度绕地球运转,与地面用户接收设备存在相对运动。接收设备测量多普勒频移。累计一段时间间隔里的多普勒周期数，称为多普勒计数。据此算出用户与卫星(在相邻2分钟的偶数分钟开始时刻所处位置)间的斜距差，这是实测数据。同时,根据用户假设位置（以经度纬度表示）也算出到卫星的斜距差。两个斜距差间存在差值说明假设位置不准，多普勒测量的斜距变化和计算出的位置之间的差值称为残量，计算定位值的目的就是寻找接收机的位置使这些残量的平方和极小也就是说使计算出的值和测量值之间的差别最小。于是再算出修正量Δλ、Δφ。当Δλ、Δφ超过规定限差时,则在原假设经度纬度上加入修正量Δλ、Δφ作为新的假设位置。然后，再重复上述过程，直到算出的墹Δλ、Δφ都小于规定限差。此时，得出的位置就是利用“子午仪”导航卫星测定的用户位置。</p>
<h3 id="4-信号格式"><a href="#4-信号格式" class="headerlink" title="4. 信号格式"></a>4. 信号格式</h3><p>为了补偿电离层折射引起的多普勒计数差值，“子午仪”卫星使用两个频率。卫星以接近于150MHz和400MHz的频率发射相干载频。频率都是直接由振荡器增频而产生的，所以发射频率非常稳定。在卫星通过期间，频率变化不超过10<sup>-1</sup>。<br>卫星存储的全部数据对载频进行相位调制，每2分钟向地面发射一次导航信号,供用户使用。每批电文由字长39位的156个字加上19个附加位组成。每批电文共有6103个码位，每码位占用发送时间约20毫秒。每码位又由两个码元组成,分成正码元和负码元。 一个正码元后接一个负码元组成“1”码位，一个负码元后接正码元组成“0”码位。</p>
<h3 id="5-卫星电文"><a href="#5-卫星电文" class="headerlink" title="5. 卫星电文"></a>5. 卫星电文</h3><p>卫星电文每2分钟发送一批, 虽然含有156个字和一个19位的终止字，但供民用的只有25个字。它们所表示的都是轨道参数，其中8个字为变化参数,表示卫星轨道摄动变化量,每2分钟变换一次。其余17个字为固定参数(开普勒参数)，在12小时内重复发送并保持不变。17个字中有11个字用来确定轨道的平均椭圆，其余并不直接用于定位计算。它们变化很慢，用以预报几个月内卫星通过的时间（准确度达到几分钟以内）。其主要缺点为不能连续定位。</p>
<h3 id="6-多普勒测量"><a href="#6-多普勒测量" class="headerlink" title="6. 多普勒测量"></a>6. 多普勒测量</h3><p>根据所接收到的导航讯息，子午仪系统的用户可以知道作为时间函数的卫星位置。</p>
<h3 id="7-静止定位（差分）"><a href="#7-静止定位（差分）" class="headerlink" title="7. 静止定位（差分）"></a>7. 静止定位（差分）</h3><p>用卫星来测定一个固定点的方法有二种。第一种方法称为“单点法”。在这种方法中用一个卫星接收机来跟踪和记录每一颗通过给定点时，卫星所发出的讯号。将这些讯号送入计算机中，用程序将这些原始数据进行联合，以获得单一的最佳三维定位成果。每一个位置的大地基准由卫星系统本身给出。<br>如果有一个基准点离开测点几百公里，那么利用一种“变位”（ Translocation）方法可以用更少的时间获得精度更高的定位成果。为了完成变位测量，需要二个或二个以上的卫星接收机，一个放在基准点上，另一个（或几个）放在待测点上。在待测点上和基准点上同时跟踪相同的卫星。由于计算机所解的是二个点之间的位置差，所以共同的误差源不起作用，从而提高了定位精度。</p>
<hr>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><h2 id="1-桑玛斯·A·小斯丹塞尔-李振伍-子午仪卫星导航系统的现状-原理-性能和应用范围-J-海洋地质与第四纪地质-1979-2"><a href="#1-桑玛斯·A·小斯丹塞尔-李振伍-子午仪卫星导航系统的现状-原理-性能和应用范围-J-海洋地质与第四纪地质-1979-2" class="headerlink" title="1. 桑玛斯·A·小斯丹塞尔, 李振伍. 子午仪卫星导航系统的现状,原理,性能和应用范围[J]. 海洋地质与第四纪地质, 1979(2)."></a>1. <a target="_blank" rel="noopener" href="https://www.sunguiyu.top/2020/Transit/Transit_Navigation_System.pdf">桑玛斯·A·小斯丹塞尔, 李振伍. 子午仪卫星导航系统的现状,原理,性能和应用范围[J]. 海洋地质与第四纪地质, 1979(2)</a>.</h2>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Algorithm/">Algorithm</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Research/">Research</a>
                    
                      <a class="hover-with-bg" href="/tags/Doppler/">Doppler</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">All articles in this blog, unless otherwise stated, adopt <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 agreement</a>, please indicate the source for reprinting!</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/preying/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">给自己祈个福吧~</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/NewWeb/">
                        <span class="hidden-mobile">A New website and Blog for myself!</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    function loadValine() {
      addScript('https://cdn.staticfile.org/valine/1.4.14/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "AAkYoy2OEuWmFWASERIYG2BI-gzGzoHsz",
          app_key: "IqkQV1RDGvkB1yG13l2SjNG6",
          placeholder: "Say something",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "en",
          highlight: false,
          recordIP: false,
          serverURLs: "",
        });
      });
    }
    waitElementVisible('vcomments', loadValine);
  </script>
  <noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments
      powered by Valine.</a></noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-md">
    <div class="container custom post-content mx-auto">
      <img src="/img/logo1.png" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:300px; height:150px;">
    </div>
  </div>


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  

  
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer>
  (function () {
    // 查询存储的记录
    function getRecord(Counter, target) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({target})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {target, time: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    }

    // 发起自增请求
    function increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    }

    // 构建自增请求体
    function buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "time": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    }

    // 校验是否为有效的 UV
    function validUV() {
      var key = 'LeanCloud_UV_Flag';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    }

    function addCount(Counter) {
      var enableIncr = 'true' === 'true' && window.location.hostname !== 'localhost';
      var getterArr = [];
      var incrArr = [];

      // 请求 PV 并自增
      var pvCtn = document.querySelector('#leancloud-site-pv-container');
      if (pvCtn || enableIncr) {
        var pvGetter = getRecord(Counter, 'site-pv').then((record) => {
          incrArr.push(buildIncrement(record.objectId))
          var ele = document.querySelector('#leancloud-site-pv');
          if (ele) {
            ele.innerText = record.time + 1;
            if (pvCtn) {
              pvCtn.style.display = 'inline';
            }
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#leancloud-site-uv-container');
      if (uvCtn || enableIncr) {
        var uvGetter = getRecord(Counter, 'site-uv').then((record) => {
          var vuv = validUV();
          vuv && incrArr.push(buildIncrement(record.objectId))
          var ele = document.querySelector('#leancloud-site-uv');
          if (ele) {
            ele.innerText = record.time + (vuv ? 1 : 0);
            if (uvCtn) {
              uvCtn.style.display = 'inline';
            }
          }
        });
        getterArr.push(uvGetter);
      }

      // 如果是文章，请求文章的浏览数，并自增
      if ('true' === 'true') {
        var viewCtn = document.querySelector('#leancloud-post-views-container');
        if (viewCtn || enableIncr) {
          var target = decodeURI('/2020/Transit/');
          var viewGetter = getRecord(Counter, target).then((record) => {
            incrArr.push(buildIncrement(record.objectId))
            if (viewCtn) {
              var ele = document.querySelector('#leancloud-post-views');
              if (ele) {
                ele.innerText = (record.time || 0) + 1;
                viewCtn.style.display = 'inline';
              }
            }
          });
          getterArr.push(viewGetter);
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && increment(Counter, incrArr);
        })
      }
    }

    var app_id = 'AAkYoy2OEuWmFWASERIYG2BI-gzGzoHsz'
    var app_key = 'IqkQV1RDGvkB1yG13l2SjNG6'
    var server_url = ''

    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': app_id,
            'X-LC-Key': app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };

      addCount(Counter);
    }

    var api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${ app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(resp => resp.json())
        .then(({api_server}) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>






  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Transit Navigation Satellite System&nbsp;",
      ],
      cursorChar: "_ゅ",
      typeSpeed: 50,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "§"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>












  

  

  

  

  

  





</body>
</html>
